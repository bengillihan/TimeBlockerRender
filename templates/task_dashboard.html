{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2>Enhanced Task Dashboard</h2>
        </div>
        <div class="col-auto">
            <button type="button" class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#addRoleModal">
                <i class="fas fa-user-tag"></i> Add Role
            </button>
            <button type="button" class="btn btn-secondary me-2" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                <i class="fas fa-folder-plus"></i> Add Category
            </button>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                <i class="fas fa-plus"></i> Add Task
            </button>
        </div>
    </div>

    <!-- Analytics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 id="total-tasks">0</h4>
                            <p class="mb-0">Total Tasks</p>
                        </div>
                        <div>
                            <i class="fas fa-tasks fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 id="completed-tasks">0</h4>
                            <p class="mb-0">Completed</p>
                        </div>
                        <div>
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 id="in-progress-tasks">0</h4>
                            <p class="mb-0">In Progress</p>
                        </div>
                        <div>
                            <i class="fas fa-clock fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 id="overdue-tasks">0</h4>
                            <p class="mb-0">Overdue</p>
                        </div>
                        <div>
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <select class="form-select" id="status-filter">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="blocked">Blocked</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="priority-filter">
                                <option value="">All Priorities</option>
                                <option value="urgent">Urgent</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="role-filter">
                                <option value="">All Roles</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="overdue-filter">
                                <label class="form-check-label" for="overdue-filter">
                                    Show only overdue tasks
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks Table -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5>Tasks</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="tasks-table">
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Category</th>
                                    <th>Role</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tasks-tbody">
                                <!-- Tasks will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-title" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="task-title" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-category" class="form-label">Category *</label>
                                <select class="form-select" id="task-category" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="task-description" class="form-label">Description</label>
                        <textarea class="form-control" id="task-description" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-role" class="form-label">Role</label>
                                <select class="form-select" id="task-role">
                                    <option value="">Select Role</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-priority" class="form-label">Priority</label>
                                <select class="form-select" id="task-priority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-due-date" class="form-label">Due Date</label>
                                <input type="datetime-local" class="form-control" id="task-due-date">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="task-estimated-hours" class="form-label">Estimated Hours</label>
                                <input type="number" class="form-control" id="task-estimated-hours" step="0.5" min="0">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="task-tags" class="form-label">Tags (comma-separated)</label>
                        <input type="text" class="form-control" id="task-tags" placeholder="e.g., urgent, client-work, research">
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="task-recurring">
                        <label class="form-check-label" for="task-recurring">
                            Recurring Task
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-task-btn">Save Task</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Role Modal -->
<div class="modal fade" id="addRoleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Role</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="role-form">
                    <div class="mb-3">
                        <label for="role-name" class="form-label">Role Name *</label>
                        <input type="text" class="form-control" id="role-name" required>
                    </div>
                    <div class="mb-3">
                        <label for="role-color" class="form-label">Color</label>
                        <input type="color" class="form-control form-control-color" id="role-color" value="#6c757d">
                    </div>
                    <div class="mb-3">
                        <label for="role-description" class="form-label">Description</label>
                        <textarea class="form-control" id="role-description" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="save-role-btn">Save Role</button>
            </div>
        </div>
    </div>
</div>

<!-- Task Detail Modal -->
<div class="modal fade" id="taskDetailModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="task-detail-title">Task Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-8">
                        <!-- Task Info -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6>Task Information</h6>
                            </div>
                            <div class="card-body" id="task-info-content">
                                <!-- Task details will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Progress Tracking -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6>Progress Tracking</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="progress-slider" class="form-label">Progress: <span id="progress-value">0</span>%</label>
                                    <input type="range" class="form-range" id="progress-slider" min="0" max="100" value="0">
                                </div>
                                <button class="btn btn-sm btn-primary" id="update-progress-btn">Update Progress</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <!-- Time Tracking -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6>Time Tracking</h6>
                            </div>
                            <div class="card-body">
                                <p><strong>Estimated:</strong> <span id="estimated-time">-</span> hours</p>
                                <p><strong>Time Spent:</strong> <span id="time-spent">-</span> hours</p>
                                <p><strong>Last Worked:</strong> <span id="last-worked">-</span></p>
                            </div>
                        </div>
                        
                        <!-- Comments -->
                        <div class="card">
                            <div class="card-header">
                                <h6>Comments</h6>
                            </div>
                            <div class="card-body">
                                <div id="comments-list" style="max-height: 200px; overflow-y: auto;">
                                    <!-- Comments will be loaded here -->
                                </div>
                                <div class="mt-3">
                                    <textarea class="form-control" id="new-comment" rows="2" placeholder="Add a comment..."></textarea>
                                    <button class="btn btn-sm btn-primary mt-2" id="add-comment-btn">Add Comment</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-warning" id="edit-task-btn">Edit Task</button>
                <button type="button" class="btn btn-danger" id="delete-task-btn">Delete Task</button>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/task_dashboard.js') }}"></script>
{% endblock %}